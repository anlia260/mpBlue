"use strict";function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _asyncToGenerator(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(o,a){try{var s=t[o](a),i=s.value}catch(e){return void r(e)}if(!s.done)return Promise.resolve(i).then(function(e){n("next",e)},function(e){n("throw",e)});e(i)}return n("next")})}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_wepy=require("./../../../npm/wepy/lib/wepy.js"),_wepy2=_interopRequireDefault(_wepy);require("./../../../npm/wepy-async-function/index.js");var _service=require("./../../../mixins/service.js"),_service2=_interopRequireDefault(_service),_wxex=require("./../../../mixins/wxex.js"),_wxex2=_interopRequireDefault(_wxex),_zanToptips=require("./../../../components/zan-toptips.js"),_zanToptips2=_interopRequireDefault(_zanToptips),_constant=require("./../../../mixins/constant.js"),Constant=_interopRequireWildcard(_constant),_zanSwitch=require("./../../../components/zan-switch.js"),_zanSwitch2=_interopRequireDefault(_zanSwitch),AreaPackageType=Constant.AreaPackageType,AreaStorageType=Constant.AreaStorageType,Alphabet=Constant.Alphabet,Index=function(e){function t(){var e,r,n,o;_classCallCheck(this,t);for(var a=arguments.length,s=Array(a),i=0;i<a;i++)s[i]=arguments[i];return r=n=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),n.config={navigationBarTitleText:"仓库-新增库位"},n.mixins=[_wxex2.default],n.computed={rows:function(){for(var e=[],t=0;t<15;t++)e.push({key:t,value:t+1,disabled:!1,checked:n.addForm.rows.includes(t)});return e},columns:function(){for(var e=[],t=0;t<15;t++)e.push({key:t,value:t+1,disabled:!1,checked:n.addForm.columns.includes(t)});return e},floors:function(){for(var e=[],t=0;t<5;t++)e.push({key:t,value:t+1,disabled:!1,checked:n.addForm.floors.includes(t)});return e}},n.$repeat={},n.$props={syncSwitch1:{"xmlns:v-bind":"","v-bind:checked.sync":"row_checked",componentId:"row"},syncSwitch2:{"v-bind:checked.sync":"column_checked",componentId:"column"},syncSwitch3:{"v-bind:checked.sync":"floor_checked",componentId:"floor"}},n.$events={},n.components={syncSwitch1:_zanSwitch2.default,syncSwitch2:_zanSwitch2.default,syncSwitch3:_zanSwitch2.default,zanToptips:_zanToptips2.default},n.events={zanSwitchChange:function(e,t){var r=e.componentId,n=e.checked;"row"===r&&(this.row_checked=n,this.addForm.rows=n?this.rows.filter(function(e){return!e.disabled}).map(function(e){return e.key}):[],this.$apply()),"column"===r&&(this.column_checked=n,this.addForm.columns=n?this.columns.map(function(e){return e.key}):[],this.$apply()),"floor"===r&&(this.floor_checked=n,this.addForm.floors=n?this.floors.map(function(e){return e.key}):[],this.$apply())}},n.data={row_checked:!1,column_checked:!1,floor_checked:!1,addForm:{ucId:null,tk:null,addressId:null,areaId:"",rows:[],columns:[],floors:[]},areaIndex:0,listArea:[],MaxPosition:null},n.methods={handleBack:function(){_wepy2.default.navigateBack({})},bindAreaChange:function(e){this.addForm.areaIndex=parseInt(e.detail.value),this.addForm.areaId=this.listArea[this.addForm.areaIndex].areaId,this.loadMax(this.listArea[this.addForm.areaIndex].areaId),this.$apply()},handleColumnClick:function(e){this.addForm.columns.includes(e)?this.addForm.columns=this.addForm.columns.filter(function(t){return t!=e}):this.addForm.columns.push(e),this.$apply()},handleFloorClick:function(e){this.addForm.floors.includes(e)?this.addForm.floors=this.addForm.floors.filter(function(t){return t!=e}):this.addForm.floors.push(e),this.$apply()},handleRowClick:function(e){var t=e.key;if(e.disabled)return!1;this.addForm.rows.includes(t)?this.addForm.rows=this.addForm.rows.filter(function(e){return e!=t}):this.addForm.rows.push(t),this.$apply()},handleSubmit:function(){function e(e){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,o,a,s,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=getCurrentPages(),n=Object.assign({},this.addForm),n.columns=n.columns.map(function(e){return e+1}).join(","),n.rows=n.rows.map(function(e){return e+1}).join(","),n.floors=n.floors.map(function(e){return e+1}).join(","),o="",""==n.areaId&&(o="请选择库区"),""==n.columns&&(o="请选择库位排数"),""==n.rows&&(o="请选择库位行数"),""==n.floors&&(o="请选择库位层数"),""==o){e.next=14;break}this.showTips(o),e.next=20;break;case 14:return e.next=16,_service2.default.Apost("position/savePositionList",n);case 16:a=e.sent,s=a.res,i=a.state,i&&wx.showToast({title:"添加库区成功",icon:"success",duration:2e3,success:function(){if(r.length>1){r[r.length-2].loadListTwo()}_wepy2.default.navigateBack({})}});case 20:case"end":return e.stop()}},e,this)}));return e}()},o=r,_possibleConstructorReturn(n,o)}return _inherits(t,e),_createClass(t,[{key:"onLoad",value:function(e){var t=this.$parent.globalData.userInfo;this.addForm.ucId=t.ucId,this.addForm.tk=t.token,this.addForm.companyId=e.companyId,this.addForm.addressId=e.addressId,this.$apply(),this.loadArea()}},{key:"loadMax",value:function(){function e(e){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,o,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r={areaId:t,ucId:this.addForm.ucId,addressId:this.addForm.addressId,tk:this.addForm.addressId},e.next=3,_service2.default.Aget("position/getMax",r);case 3:n=e.sent,o=n.res,a=n.state,a&&(this.MaxPosition=o,this.$apply());case 7:case"end":return e.stop()}},e,this)}));return e}()},{key:"loadArea",value:function(){function e(){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t={ucId:this.addForm.ucId,addressId:this.addForm.addressId,tk:this.addForm.tk},e.next=3,_service2.default.Aget("area/listArea",t);case 3:r=e.sent,n=r.res,o=r.state,o&&(this.listArea=n,this.$apply());case 7:case"end":return e.stop()}},e,this)}));return e}()}]),t}(_wepy2.default.page);Page(require("./../../../npm/wepy/lib/wepy.js").default.$createPage(Index,"pages/mine/company/position-add"));