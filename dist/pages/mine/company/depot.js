"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _asyncToGenerator(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){function a(i,r){try{var s=t[i](r),o=s.value}catch(e){return void n(e)}if(!s.done)return Promise.resolve(o).then(function(e){a("next",e)},function(e){a("throw",e)});e(o)}return a("next")})}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),_wepy=require("./../../../npm/wepy/lib/wepy.js"),_wepy2=_interopRequireDefault(_wepy),_lodash=require("./../../../npm/lodash/lodash.js"),_lodash2=_interopRequireDefault(_lodash),_service=require("./../../../mixins/service.js"),_service2=_interopRequireDefault(_service),_zanQuantity=require("./../../../components/zan-quantity.js"),_zanQuantity2=_interopRequireDefault(_zanQuantity),sliderWidth=100,Index=function(e){function t(){var e,n,a,i;_classCallCheck(this,t);for(var r=arguments.length,s=Array(r),o=0;o<r;o++)s[o]=arguments[o];return n=a=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),a.config={navigationBarTitleText:"仓库管理"},a.$repeat={},a.$props={entranceNum:{"xmlns:v-bind":"","v-bind:quantity.sync":"entranceNum","v-bind:min.once":"min1","v-bind:max.once":"max1",componentId:"entranceNum"},deviceNum:{"v-bind:quantity.sync":"deviceNum","v-bind:min.once":"min2","v-bind:max.once":"max2",componentId:"deviceNum"}},a.$events={},a.components={entranceNum:_zanQuantity2.default,deviceNum:_zanQuantity2.default},a.data={entranceNum:1,deviceNum:1,min1:1,max1:20,min2:1,max2:100,tabs:["库区","库位","设备","出入口"],urls:["area-add","position-add","divice-add","entrance-add"],DiviceType:[{key:2,value:"容器"},{key:3,value:"捡货篮"},{key:1,value:"托盘"}],diviceForm:{},entranceAdd:!1,deviceAdd:!1,listOne:[],listOnePage:1,listTwo:[],listTwoPage:1,listThree:[],listThreePage:1,listFour:[],listFourPage:1,activeIndex:0,sliderOffset:0,sliderLeft:0,userInfo:{nickName:"加载中..."},typeIndex:0,addressId:0,companyId:0},a.events={zanQuantityChange:function(e,t){var n=e.componentId,a=e.quantity;this[n]=a,console.log(this[n]),this.$apply()}},a.methods={listTwolower:function(e){console.log(e),a.listTwo&&(a.listTwoPage+=1,a.loadListTwo())},handleClearOne:function(e){a.listOneAdd=!1,a.$apply()},changeDeviceChonse:function(){a.deviceAdd=!a.deviceAdd},changeEntranceChonse:function(){a.entranceAdd=!a.entranceAdd},handleAdd:function(e){2==a.activeIndex?a.deviceAdd=!0:3==a.activeIndex&&(a.entranceAdd=!0),a.$apply()},handleEntranceCancle:function(){this.entranceAdd=!1,this.$apply()},handleDeviceCancle:function(){this.deviceAdd=!1,this.$apply()},handleEntranceSubmit:function(){function e(e){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n,a,i=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={ucId:this.userInfo.ucId,tk:this.userInfo.token,addressId:this.addressId,num:this.entranceNum},e.next=3,_service2.default.Apost("entrance/saveEntrances",n);case 3:a=e.sent,a.state&&wx.showToast({title:"添加出入口成功",icon:"success",duration:2e3,success:function(){i.loadListFour(),i.entranceNum=1,i.activeIndex=3,i.entranceAdd=!1,i.$apply(),i.loadListThree()}});case 5:case"end":return e.stop()}},e,this)}));return e}(),bindDiviceTypeChange:function(e){this.typeIndex=parseInt(e.detail.value),this.diviceForm.type=this.DiviceType[this.typeIndex].key,this.$apply()},handleDeviceSubmit:function(){function e(e){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n,a,i,r,s=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={ucId:this.userInfo.ucId,tk:this.userInfo.token,addressId:this.addressId,num:this.deviceNum,typeId:this.diviceForm.type},e.next=3,_service2.default.Apost("device/saveDevices",n);case 3:a=e.sent,i=a.res,r=a.state,r&&wx.showToast({title:"添加设备成功",icon:"success",duration:2e3,success:function(){s.loadListFour(),s.deviceNum=1,s.activeIndex=2,s.deviceAdd=!1,s.$apply(),s.loadListThree()}});case 7:case"end":return e.stop()}},e,this)}));return e}(),tabClick:function(e){a.sliderOffset=e.currentTarget.offsetLeft,a.activeIndex=e.currentTarget.id,a.entranceAdd=!1,a.deviceAdd=!1,0==a.activeIndex?a.loadListOne():1==a.activeIndex?a.loadListTwo():2==a.activeIndex?a.loadListThree():3==a.activeIndex&&a.loadListFour(),a.$apply()}},i=n,_possibleConstructorReturn(a,i)}return _inherits(t,e),_createClass(t,[{key:"onLoad",value:function(e){var t=this.$parent.globalData.userInfo;this.userInfo=t,this.addressId=e.addressId,this.companyId=e.companyId,this.diviceForm.type=this.DiviceType[this.typeIndex].key,this.$apply();var n=this;_wepy2.default.getSystemInfo({success:function(e){n.sliderLeft=(e.windowWidth/n.data.tabs.length-sliderWidth)/2,n.sliderOffset=e.windowWidth/n.data.tabs.length*n.data.activeIndex,n.$apply()}}),this.loadListOne()}},{key:"byGroup",value:function(e,t,n){var a=_lodash2.default.groupBy(e,function(e){return e[t]}),i=[];return Object.keys(a).forEach(function(e){var t={title:n?n[e]:e,list:a[e]};i.push(t)}),i}},{key:"loadListOneBase",value:function(){var e=this,t=this.$parent.globalData.userInfo;this.userInfo=t,_service2.default.requestGet("area/listArea",{tk:this.userInfo.token,ucId:this.userInfo.ucId,addressId:this.addressId},function(t,n){n&&(e.listOne=t.data.data,e.$apply())})}},{key:"loadListOne",value:function(){var e=this,t=this.$parent.globalData.userInfo;this.userInfo=t,_service2.default.requestGet("area/listArea",{tk:t.token,addressId:this.addressId,ucId:t.ucId},function(t,n){n&&(e.listOne=t.data.data,e.$apply())})}},{key:"loadListTwo",value:function(){var e=this,t=this.$parent.globalData.userInfo;this.userInfo=t,_service2.default.requestGet("position/listPosition",{tk:t.token,addressId:this.addressId,pageSize:20,pageNum:this.listTwoPage,ucId:t.ucId},function(t,n){n&&(e.listTwo=e.byGroup(t.data.data,"areaName"),e.$apply())})}},{key:"loadListThree",value:function(){var e=this,t=this.$parent.globalData.userInfo;this.userInfo=t,_service2.default.requestGet("device/listDevice",{tk:t.token,pageSize:20,pageNum:1,addressId:this.addressId,ucId:t.ucId},function(t,n){if(n){var a={1:"托盘",2:"箱子"};e.listThree=e.byGroup(t.data.data,"typeId",a),e.$apply()}})}},{key:"loadListFour",value:function(){var e=this,t=this.$parent.globalData.userInfo;this.userInfo=t,_service2.default.requestGet("entrance/list",{tk:t.token,pageSize:1e3,pageNum:1,addressId:this.addressId,ucId:t.ucId},function(t,n){n&&(e.listFour=t.data.data,e.$apply())})}},{key:"loadUserInfo",value:function(){var e=this,t=this.$parent.globalData.userInfo;t?(this.userInfo=t,this.$apply()):this.$parent.getUserInfo(function(t){t&&(e.userInfo=t),e.$apply()})}}]),t}(_wepy2.default.page);Page(require("./../../../npm/wepy/lib/wepy.js").default.$createPage(Index,"pages/mine/company/depot"));