"use strict";function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _asyncToGenerator(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,n){function i(r,s){try{var a=e[r](s),o=a.value}catch(t){return void n(t)}if(!a.done)return Promise.resolve(o).then(function(t){i("next",t)},function(t){i("throw",t)});t(o)}return i("next")})}}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),_wepy=require("./../../../npm/wepy/lib/wepy.js"),_wepy2=_interopRequireDefault(_wepy),_service=require("./../../../mixins/service.js"),_service2=_interopRequireDefault(_service),_wxex=require("./../../../mixins/wxex.js"),_wxex2=_interopRequireDefault(_wxex),_zanQuantity=require("./../../../components/zan-quantity.js"),_zanQuantity2=_interopRequireDefault(_zanQuantity),_zanToptips=require("./../../../components/zan-toptips.js"),_zanToptips2=_interopRequireDefault(_zanToptips),Index=function(t){function e(){var t,n,i,r,s=this;_classCallCheck(this,e);for(var a=arguments.length,o=Array(a),u=0;u<a;u++)o[u]=arguments[u];return n=i=_possibleConstructorReturn(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),i.config={navigationBarTitleText:"确认拣货数量"},i.mixins=[_wxex2.default],i.computed={},i.$repeat={},i.$props={zanQuantity:{"xmlns:v-bind":"","v-bind:quantity.sync":"innum","v-bind:min.once":"min","v-bind:max.sync":"max",componentId:"innum"}},i.$events={},i.components={zanToptips:_zanToptips2.default,zanQuantity:_zanQuantity2.default},i.data={innum:0,min:0,taskStatus:1,max:20,isVirtul:2,pickInfo:{},pickDetail:{}},i.events={zanQuantityChange:function(t,e){var n=t.componentId,i=t.quantity;this[n]=i,this.$apply()}},i.methods={fullBasket:function(){function t(t){return e.apply(this,arguments)}var e=_asyncToGenerator(regeneratorRuntime.mark(function t(e){var n,r,a,o,u,c;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return wx.showLoading({title:"加载中",mask:!0}),n={ucId:i.userInfo.ucId,tk:i.userInfo.token,taskId:i.taskInfo.taskId,orderId:i.pickDetail.orderId,basketId:i.pickDetail.basketId},t.next=4,_service2.default.Apost("pick/fullBasket",n);case 4:r=t.sent,a=r.res,o=r.msg,u=r.code,c=r.state,wx.hideLoading(),c?(i.pickDetail.basketId=a.basketId,i.pickDetail.basketSn=a.deviceSn,i.pickDetail.taskId=a.taskId,1!=a.status&&i.pickDetail.orderId!=a.orderId&&i.getPickInfo()):408==u?i.finishTask(i.taskInfo.taskId):(i.pickInfo={},i.showTips(o)),i.$apply();case 12:case"end":return t.stop()}},t,s)}));return t}()},r=n,_possibleConstructorReturn(i,r)}return _inherits(e,t),_createClass(e,[{key:"finishTask",value:function(){function t(t){return e.apply(this,arguments)}var e=_asyncToGenerator(regeneratorRuntime.mark(function t(e){var n,i,r,s,a,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n={ucId:this.userInfo.ucId,tk:this.userInfo.token,taskId:e},t.next=3,_service2.default.Apost("pick/finishTask",n);case 3:i=t.sent,r=i.res,s=i.state,a=i.msg,o=i.code,200==o?(this.taskStatus=2,this.$navigate("./ok")):this.showTips(a);case 9:case"end":return t.stop()}},t,this)}));return t}()},{key:"onShow",value:function(){2===this.taskStatus&&this.backUrl("todo")}},{key:"onLoad",value:function(t,e){var n=this.$parent.globalData.userInfo;this.taskInfo=e.preload?e.preload.taskInfo:{},this.userInfo=n,this.$apply(),1===this.taskStatus&&this.getPickInfo()}},{key:"handleSubmit",value:function(){function t(){return e.apply(this,arguments)}var e=_asyncToGenerator(regeneratorRuntime.mark(function t(){var e,n,i=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e=getCurrentPages(),n={ucId:this.userInfo.ucId,tk:this.userInfo.token,num:this.innum,taskId:this.taskInfo.taskId,type:this.taskInfo.orderId,pickId:this.pickDetail.pickId},this.innum<this.max?wx.showActionSheet({itemList:["捡货箱已满","库存不足"],success:function(t){t.cancel||(n.type=t.tapIndex+2,i.confirmPick(n))}}):(n.type=1,this.confirmPick(n));case 3:case"end":return t.stop()}},t,this)}));return t}()},{key:"confirmPick",value:function(){function t(t){return e.apply(this,arguments)}var e=_asyncToGenerator(regeneratorRuntime.mark(function t(e){var n,i,r,s,a,o,u,c;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return wx.showLoading({title:"加载中",mask:!0}),n=this.pickDetail,i=n.packageType,r=n.basketId,e.basketId=1==i?0:r,t.next=5,_service2.default.Apost("pick/confirmPick",e);case 5:s=t.sent,a=s.res,o=s.msg,u=s.state,c=s.code,wx.hideLoading(),u?this.getPickInfo():(this.showTips(o),2007===c&&this.getPickInfo()),this.$apply();case 13:case"end":return t.stop()}},t,this)}));return t}()},{key:"getPickInfo",value:function(){function t(t){return e.apply(this,arguments)}var e=_asyncToGenerator(regeneratorRuntime.mark(function t(e){var n,i,r,s,a,o,u,c;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return wx.showLoading({title:"加载中",mask:!0}),n={ucId:this.userInfo.ucId,tk:this.userInfo.token,positionId:this.taskInfo.positionId||0,areaId:this.taskInfo.areaId,taskId:this.taskInfo.taskId,pickOrderId:this.taskInfo.orderId||"",addressId:this.taskInfo.houseId},t.next=4,_service2.default.Apost("pick/getPick",n);case 4:i=t.sent,r=i.res,s=i.msg,a=i.code,o=i.state,wx.hideLoading(),200==a?(u=r.num,c=r.getNum,this.max=u-c,this.pickDetail=r,this.innum=this.pickDetail.num-this.pickDetail.getNum,this.isVirtul=this.pickDetail.deviceSn.substring(2,3)):408==a?(this.taskStatus=2,this.$navigate("./ok")):(this.pickDetail={},this.isVirtul=2,this.showTips(s)),this.$apply();case 12:case"end":return t.stop()}},t,this)}));return t}()}]),e}(_wepy2.default.page);Page(require("./../../../npm/wepy/lib/wepy.js").default.$createPage(Index,"pages/workbench/picking/sureNum"));