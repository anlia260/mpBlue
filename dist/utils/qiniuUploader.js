"use strict";!function(){function n(n){a={qiniuRegion:"",qiniuImageURLPrefix:"",qiniuUploadToken:"",qiniuUploadTokenURL:"",qiniuUploadTokenFunction:null,qiniuShouldUseQiniuFileName:!1},e(n)}function e(n){n.region?a.qiniuRegion=n.region:console.error("qiniu uploader need your bucket region"),n.uptoken?a.qiniuUploadToken=n.uptoken:n.uptokenURL?a.qiniuUploadTokenURL=n.uptokenURL:n.uptokenFunc&&(a.qiniuUploadTokenFunction=n.uptokenFunc),n.domain&&(a.qiniuImageURLPrefix=n.domain),a.qiniuShouldUseQiniuFileName=n.shouldUseQiniuFileName}function i(n,i,l,r){if(null==n)return void console.error("qiniu uploader need filePath to upload");if(r&&e(r),a.qiniuUploadToken)o(n,i,l,r);else if(a.qiniuUploadTokenURL)u(function(){o(n,i,l,r)});else{if(!a.qiniuUploadTokenFunction)return void console.error("qiniu uploader need one of [uptoken, uptokenURL, uptokenFunc]");if(a.qiniuUploadToken=a.qiniuUploadTokenFunction(),null==a.qiniuUploadToken&&a.qiniuUploadToken.length>0)return void console.error("qiniu UploadTokenFunction result is null, please check the return value")}}function o(n,e,i,o){if(null==a.qiniuUploadToken&&a.qiniuUploadToken.length>0)return void console.error("qiniu UploadToken is null, please check the init config or networking");var u=l(a.qiniuRegion),r=n.split("//")[1];o&&o.key&&(r=o.key);var t={token:a.qiniuUploadToken};a.qiniuShouldUseQiniuFileName||(t.key=r),wx.uploadFile({url:u,filePath:n,name:"file",formData:t,success:function(n){var o=n.data;try{var u=JSON.parse(o),l=a.qiniuImageURLPrefix+"/"+u.key;u.imageURL=l,e&&e(u)}catch(n){console.log("parse JSON failed, origin String is: "+o),i&&i(n)}},fail:function(n){console.error(n),i&&i(n)}})}function u(n){wx.request({url:a.qiniuUploadTokenURL,success:function(e){var i=e.data.uptoken;i&&i.length>0?(a.qiniuUploadToken=i,n&&n()):console.error("qiniuUploader cannot get your token, please check the uptokenURL or server")},fail:function(n){console.error("qiniu UploadToken is null, please check the init config or networking: "+n)}})}function l(n){var e=null;switch(n){case"ECN":e="https://upload.qiniup.com";break;case"NCN":e="https://up-z1.qbox.me";break;case"SCN":e="https://up-z2.qbox.me";break;case"NA":e="https://up-na0.qbox.me";break;default:console.error("please make the region is with one of [ECN, SCN, NCN, NA]")}return e}var a={qiniuRegion:"",qiniuImageURLPrefix:"",qiniuUploadToken:"",qiniuUploadTokenURL:"",qiniuUploadTokenFunction:null,qiniuShouldUseQiniuFileName:!1};module.exports={init:n,upload:i}}();